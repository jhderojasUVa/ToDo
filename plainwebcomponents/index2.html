<html>
    <head>
        <title>WebSocket example</title>
    </head>
    <body>
        <a href="#" onclick="sendGET()">click me (GET)!</a>
        <br />
        <a href="#" onclick="sendPUT()">click me (PUT)!</a>
        <div id="items"></div>
    </body>
<script>
var ws = new WebSocket("ws://localhost:8080/" ,"protocolOne");

var idToPut = document.getElementById('items');

var get = { type: "get" };

if ('WebSocket' in window) {
    
    ws.open = () => {
        console.log('Connection to websocket open');
    }

    ws.onmessage = (message) => {
        console.log(JSON.parse(message.data));
        jsonMessage = JSON.parse(message.data);
        if (jsonMessage.connection == undefined) {
            console.log('cccc');
            let tmp = fillItems(jsonMessage);
            idToPut.appendChild(tmp);
        }
    }

    ws.onclose = () => {
        console.log('Websocket connection clossed');
    }
} else {
    alert('Your browser doesn\'t support websockets!');
}

function sendGET() {
    ws.send(JSON.stringify(get));
}

function sendPUT() {
    let words = ['caca', 'culo', 'pedo', 'pis', 'garifante', 'aluci', 'dromedario'];
    let randomText = words[Math.floor(Math.random()*words.length)] + ' ' + words[Math.floor(Math.random()*words.length)] + ' ' + words[Math.floor(Math.random()*words.length)];
    let put = {
        type: 'post',
        whatToDo: randomText,
        completed: true
    };

    ws.send(JSON.stringify(put));
}

function fillItems(items) {
    //console.log('sdadadsa');
    let ul = document.createElement('ul')
    //let jsonItem = JSON.parse(items);
    jsonItem = items;
    console.log(jsonItem);
    jsonItem.ToDos.forEach((element) =>{
        let li = document.createElement('li');
        li.innerHTML = element.whatToDo;
        ul.appendChild(li);
    });
    return ul;
}
</script>
</html>